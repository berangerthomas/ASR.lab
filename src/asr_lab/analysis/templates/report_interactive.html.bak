<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ASR Benchmark Report - Interactive</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; background: #f5f5f5; color: #333; line-height: 1.6; }
        .container { max-width: 1600px; margin: 0 auto; background: white; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 2em; text-align: center; }
        header h1 { font-size: 2.5em; margin-bottom: 0.3em; font-weight: 300; }
        header .subtitle { opacity: 0.9; font-size: 1.1em; }
        header .meta-info { 
            display: flex; 
            justify-content: center; 
            gap: 2em; 
            margin-top: 1.5em; 
            font-size: 0.9em; 
            opacity: 0.95;
            flex-wrap: wrap;
        }
        header .meta-info > div { 
            display: flex; 
            align-items: center; 
            gap: 0.5em;
        }
        header .meta-info strong { 
            font-weight: 600; 
            opacity: 0.8;
        }
        .content { padding: 2em; }
        section { margin-bottom: 3em; }
        h2 { color: #667eea; border-bottom: 3px solid #667eea; padding-bottom: 0.5em; margin-bottom: 1em; font-weight: 400; }
        h3 { color: #555; margin: 1.5em 0 0.5em; font-weight: 500; }
        .info-box { background: #f8f9fa; border-left: 4px solid #667eea; padding: 1em 1.5em; margin: 1em 0; border-radius: 4px; }
        .info-box p { margin: 0.3em 0; }
        .info-box strong { color: #667eea; }
        
        /* Tabs */
        .tabs { display: flex; border-bottom: 2px solid #ddd; margin: 1em 0 0; flex-wrap: wrap; }
        .tab-button { background: #f2f2f2; border: none; border-bottom: 3px solid transparent; padding: 0.8em 1.5em; cursor: pointer; font-size: 1em; transition: all 0.3s; flex: 1; min-width: 150px; }
        .tab-button:hover { background: #e8e8e8; }
        .tab-button.active { background: white; border-bottom-color: #667eea; color: #667eea; font-weight: 500; }
        .tab-content { display: none; padding: 1.5em 0; }
        .tab-content.active { display: block; }
        
        /* Tables */
        table { border-collapse: collapse; width: 100%; margin: 1em 0; font-size: 0.95em; }
        th, td { border: 1px solid #ddd; padding: 0.8em; text-align: left; }
        th { background: #667eea; color: white; font-weight: 500; position: sticky; top: 0; }
        tr:nth-child(even) { background: #f9f9f9; }
        tr:hover { background: #f0f0f0; }
        td.number { text-align: right; font-family: 'Courier New', monospace; }
        
        /* Segment display */
        .segment { margin: 0.3em 0; font-size: 0.9em; }
        .segment strong { color: #667eea; }
        
        /* Plotly container */
        .plotly-container { margin: 1.5em 0; border: 1px solid #ddd; border-radius: 4px; overflow: hidden; }
        
        /* Footer */
        footer { background: #f8f9fa; padding: 1.5em; text-align: center; color: #666; font-size: 0.9em; border-top: 1px solid #ddd; }
        
        /* Responsive */
        @media (max-width: 768px) {
            .content { padding: 1em; }
            header h1 { font-size: 1.8em; }
            table { font-size: 0.85em; }
            th, td { padding: 0.5em; }
            
            /* Stack transcription columns on mobile */
            section > div > div[style*="grid-template-columns"] {
                display: block !important;
            }
            section > div > div[style*="grid-template-columns"] > div {
                margin-bottom: 1em;
            }
        }
        
        /* Scrollable table wrapper */
        .table-wrapper { overflow-x: auto; }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üéôÔ∏è ASR Benchmark Report</h1>
            <p class="subtitle">Interactive Analysis Dashboard</p>
            <div class="meta-info">
                <div>
                    <span>üìÖ</span>
                    <span><strong>Generated:</strong> {{ generation_date }}</span>
                </div>
                <div>
                    <span>üî¨</span>
                    <span><strong>Experiments:</strong> {{ results|length }}</span>
                </div>
                <div>
                    <span>ü§ñ</span>
                    <span><strong>Engines:</strong> {{ engines|join(', ') }}</span>
                </div>
                <div>
                    <span>üåç</span>
                    <span><strong>Languages:</strong> {{ languages|join(', ') }}</span>
                </div>
            </div>
        </header>

        <div class="content">
            <!-- Interactive Dashboard -->
            <section>
                <h2>üìä Interactive Dashboard</h2>
                <div class="plotly-container">
                    {{ plotly_div|safe }}
                </div>
            </section>

            <!-- Summary Table (right under the dashboard) -->
            <section>
                <h2>üìã Summary Table</h2>
                <div class="table-wrapper">
                    <table>
                        <thead>
                            <tr>
                                <th>Dataset</th>
                                <th>Engine</th>
                                <th>Language</th>
                                <th>Type</th>
                                <th>WER</th>
                                <th>Time (s)</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for row in results %}
                            <tr>
                                <td>{{ row.dataset }}</td>
                                <td><strong>{{ row.engine }}</strong></td>
                                <td>{{ row.language|upper }}</td>
                                <td>{{ row.degradation|capitalize }}</td>
                                <td class="number">{{ "%.4f"|format(row.wer) if row.wer is not none else 'N/A' }}</td>
                                <td class="number">{{ "%.2f"|format(row.time_s) if row.time_s is not none else 'N/A' }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Detailed Results Tables -->
            <section>
                <h2>ÔøΩ Detailed Transcriptions</h2>
                <div class="tabs">
                    <button class="tab-button active" onclick="openTab(event, 'summary')">Summary</button>
                    <button class="tab-button" onclick="openTab(event, 'timestamps')">Transcription Details</button>
                </div>

                <!-- Summary Tab -->
                <div id="summary" class="tab-content active">
                    <h3>Summary Table</h3>
                    <div class="table-wrapper">
                        <table>
                            <thead>
                                <tr>
                                    <th>Dataset</th>
                                    <th>Engine</th>
                                    <th>Language</th>
                                    <th>Type</th>
                                    <th>WER</th>
                                    <th>Time (s)</th>
                                    <th>Reference Text</th>
                                    <th>Transcribed Text</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for row in results %}
                                <tr>
                                    <td>{{ row.dataset }}</td>
                                    <td><strong>{{ row.engine }}</strong></td>
                                    <td>{{ row.language|upper }}</td>
                                    <td>{{ row.degradation|capitalize }}</td>
                                    <td class="number">{{ "%.4f"|format(row.wer) if row.wer is not none else 'N/A' }}</td>
                                    <td class="number">{{ "%.2f"|format(row.time_s) if row.time_s is not none else 'N/A' }}</td>
                                    <td style="max-width: 300px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;" title="{{ row.reference_text }}">{{ row.reference_text[:100] }}{% if row.reference_text|length > 100 %}...{% endif %}</td>
                                    <td style="max-width: 300px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;" title="{{ row.transcription.text }}">{{ row.transcription.text[:100] }}{% if row.transcription.text|length > 100 %}...{% endif %}</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Timestamps Tab -->
                <div id="timestamps" class="tab-content">
                    <h3>Transcription Details with Timestamps</h3>
                    <div class="table-wrapper">
                        <table>
                            <thead>
                                <tr>
                                    <th>Dataset</th>
                                    <th>Engine</th>
                                    <th>Segments</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for row in results %}
                                <tr>
                                    <td>{{ row.dataset }}</td>
                                    <td><strong>{{ row.engine }}</strong></td>
                                    <td>
                                        {% if row.transcription.segments %}
                                            {% for segment in row.transcription.segments %}
                                                <div class="segment">
                                                    <strong>[{{ "%.2f"|format(segment.timestamp[0]) }}s - {{ "%.2f"|format(segment.timestamp[1]) }}s]:</strong> {{ segment.text }}
                                                </div>
                                            {% endfor %}
                                        {% else %}
                                            <em style="color: #999;">No timestamp data available.</em>
                                        {% endif %}
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Full Transcriptions -->
            <section>
                <h2>üìù Full Transcriptions - Side by Side Comparison</h2>
                {% for row in results %}
                <div style="border: 1px solid #ddd; padding: 1.5em; margin: 1.5em 0; border-radius: 8px; background: #fafafa;">
                    <h3 style="color: #667eea; margin-top: 0;">{{ row.dataset }} - {{ row.engine }}</h3>
                    <div style="margin: 0.5em 0 1em; padding: 0.8em; background: white; border-radius: 4px;">
                        <strong>WER:</strong> {{ "%.4f"|format(row.wer) if row.wer is not none else 'N/A' }} | 
                        <strong>Time:</strong> {{ "%.2f"|format(row.time_s) }}s |
                        <strong>Type:</strong> {{ row.degradation|capitalize }}
                    </div>
                    
                    <!-- Side by side comparison -->
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1em; margin-top: 1em;">
                        <!-- Reference Text Column -->
                        <div>
                            <p style="margin-bottom: 0.5em; font-weight: 600; color: #667eea; font-size: 1.1em;">ÔøΩ Reference Text</p>
                            <div style="background: white; padding: 1.2em; border-left: 4px solid #667eea; border-radius: 4px; min-height: 200px; line-height: 1.8;">
                                {{ row.reference_text }}
                            </div>
                        </div>
                        
                        <!-- Transcribed Text Column -->
                        <div>
                            <p style="margin-bottom: 0.5em; font-weight: 600; color: #764ba2; font-size: 1.1em;">üé§ Transcribed Text</p>
                            <div style="background: white; padding: 1.2em; border-left: 4px solid #764ba2; border-radius: 4px; min-height: 200px; line-height: 1.8;">
                                {{ row.transcription.text }}
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </section>
        </div>

        <footer>
            <p>Generated by ASR.lab - Automatic Speech Recognition Benchmarking Platform</p>
            <p>{{ generation_date }}</p>
        </footer>
    </div>

    <script>
        function openTab(evt, tabName) {
            var i, tabcontent, tablinks;
            tabcontent = document.getElementsByClassName("tab-content");
            for (i = 0; i < tabcontent.length; i++) {
                tabcontent[i].style.display = "none";
            }
            tablinks = document.getElementsByClassName("tab-button");
            for (i = 0; i < tablinks.length; i++) {
                tablinks[i].className = tablinks[i].className.replace(" active", "");
            }
            document.getElementById(tabName).style.display = "block";
            evt.currentTarget.className += " active";
        }
    </script>
</body>
</html>
